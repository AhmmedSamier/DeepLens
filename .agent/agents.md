# Agent Instructions & Project Learnings

## System Preferences
- **Package Manager**: Always use `bun` for package management, running scripts, and development tasks.
- **Runtimes**: Prefer `bun` over `node` where applicable.

## Cognitive Lens: Indexing Performance Learnings
From the analysis of the `cognitive-lens` extension, we have implemented and learned the following:

### 1. Concurrency is King
- **Parallel Processing**: Avoid sequential loops for symbol extraction. Processing files in concurrent chunks (e.g., concurrency limit of 10) significantly reduces indexing time.
- **Batched Updates**: report progress in batches to avoid flooding the UI/LSP channel.

### 2. Optimize File Access
- **Byte-level Reads**: Use low-level file system reads (e.g., `vscode.workspace.fs.readFile`) to check for file markers (like `// <auto-generated />`) instead of `workspace.openTextDocument`. This avoids initializing full language server support for files that might be skipped.
- **Early Exits**: Exit checks as soon as possible after reading the required header bytes.

### 3. Smart Retry vs. Fixed Delays
- **Reactive Timing**: Instead of using fixed `setTimeout` delays between file scans, use smart retry logic. Only wait if a provider returns no results, giving the language server a moment to "warm up" only when necessary.

## Development Workflow
1. Use `bun install` for dependency management.
2. Use `bun run compile` or `bun run dev` for building.
3. Use `bun test` for testing (where compatible).
